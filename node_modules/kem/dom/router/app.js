var DOM = require('../lib/dom.js'),
    cache = require('../../lib/cache/index.js'),
    cookie = require('../../lib/cookie/index.js'),
    App = document.getElementById('app');

App.style.height = window.innerHeight + 'px';

function currentController() {
	return cookie.has('user') && cookie.has('time') && cache.hasLocal('user') ? 'index' : 'account';
}

module.exports = class Router extends DOM {

	constructor(props) {
		super(props);
		this.state = { body: null };
	}

	componentWillMount() {

		var router = this.props,
		    current = '',
		    now = '',
		    controller;

		/**
		 *	See module Link for event 'render'
		 */

		this.on('render', function (pathname) {
			var array = pathname.split('/').splice(1);
			now = array[0] || currentController();

			if (current !== now) {
				current = now;
				controller = new (router[now])();

				App.replaceChild(controller.done, App.childNodes[0]);
			}

			controller._parse_action(array[1], array.slice(2));
		});
		this.emit('render', []);
	}
	render() {
		App.appendChild(new Comment());
		return App;
	}
}