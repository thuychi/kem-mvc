var http = require('http');

var App = module.exports = {
	routes: [],
	middleware: [],
	server: null,
	define: {},

	init: function(define){
		this.define = define;
		this.server = http.createServer(this.handle.bind(this)).listen(this.define.port, this.define.host);

		return this;
	},
	set: function(key, value){
		this.define[key] = value;
	},
	get: function(key){
		return this.define[key];
	},
	error: function(fn){
		this._error = fn;
	},

	use: function(uri, fn){
		('string' === typeof uri) ? this.routes.push({ uri: new RegExp('^' + uri + '$'), fn }) : this.middleware.push(uri);
	},
	handle: function(req, res){
		var i = 0, n = this.middleware.length;
		if(!n || req.url==='/favicon.ico') return res.end();

		for(; i < n; i++){
			this.middleware[i](req, res);
		}
	}
}